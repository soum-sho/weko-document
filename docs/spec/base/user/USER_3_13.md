### アイテム利用申請機能

- 目的

本機能は、コンテンツファイルが登録されていないアイテムに対して、利用申請を行う機能。

- 利用方法

アイテム詳細画面の左側にある、「申請」ボタンを押下することで、アイテムの利用申請を行う。

- 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
</tr>
</tbody>
</table>

- 機能内容

- アイテム詳細画面に「申請」ボタンを表示する。

  - コンテンツファイル未登録時の利用申請方法について、定義されている場合のみ表示される。

  - 管理者または、登録者の場合には当該ボタンを表示しない。

- 権限がないユーザーは、「申請」ボタンを押下し、利用申請を実施できる。

  - このとき、利用規約のみのワークフローが指定されている場合、エラーメッセージを表示する。

  - 利用申請設定時に利用規約が設定されている場合モーダル画面を表示する。

    - 「利用規約 (Terms and Conditions)」をモーダル画面上部に表示する。

    - モーダル画面の下部に以下の文言を表示する。  
      「利用規約を確認の上、スクロール最下部にある「利用規約に同意する」にチェックを入れてください」

    - 「利用規約に同意する」チェックボックスをモーダル画面に併せて表示する。

      - 利用規約を最後まで確認すると「利用規約に同意する」チェックボックスをチェックできる。

      - チェックボックスがチェックされていない場合、「次へ」ボタンを非活性とする

    - 非ログインユーザの場合:  
        メールアドレスが入力できるモーダル画面が表示される。メールアドレスを入力し「Enable」ボタンを押下するとメールが送付される。

      - 受信したメール文のリンクをクリックするとワークフローに定義されているアクション画面（アイテム登録画面など）に遷移する

      - リンクはランダムなURLとトークン値から構成し、両者が一致した場合に利用登録ワークフローへのリンクとして機能する

    - 事前に指定されたワークフロー用いて作成されたアクティビティのアイテム登録画面に遷移する。

- 関連モジュール
  - weko_records_ui
  - weko_workflow

- 設定

  - なし

- 前提条件

  - アイテム利用申請テーブルに該当アイテムの利用申請方法が登録されている場合

- 実装方法

  - アイテム詳細画面を表示する際、DBテーブルから、当該アイテムのリクエスト送信先が登録されているか確認する。もし、利用申請方法が設定されている場合、申請ボタンを表示する。

- 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2025/10/10</p>
</blockquote></td>
<td></td>
<td>初版作成</td>
</tr>
</tbody>
</table>
