## 未病データベース GakuNinRDMボタン表示

アイテム詳細画面のGakuNinRDM(以下GRDM)ボタンの表示について記述する。

### 用語説明

本書では以下の用語で統一する。

  | 用語 | 説明 |
  | ---- | ---- |
  | フロント | 未病データベースのフロントエンド |
  | WEKO | 未病データベース用のWEKO3リポジトリ（バックエンド） |
  | プロジェクトURL | GRDMのプロジェクトや共有リクエストのURL  |

### 1. RO-CrateからWEKOのアイテムへの変換

プロジェクトURLはRO-Crate内で`ams:projectid`として記述される。  
WEKOのJSON-LDマッピング機能（[ADMIN_1_5：JSON-LDマッピング](../admin/ADMIN_1_5.md)を使用して、`ams:projectid`を未病アイテムタイプのプロジェクトURL(関連情報プロパティ)にマッピングする。

`ams:projectid`は`プロジェクトURL.関連識別子.関連識別子`にマッピングする。(以下、関連識別子とする。)  
また、`プロジェクトURL.関連タイプ`に固定値で`xxx`(未定)をマッピングする。(以下、関連タイプとする。)  
JSON-LDマッピング機能により、`プロジェクトURL.関連タイプ`は`ams:projectid`が存在する場合のみアイテムに登録される。

マッピング定義は以下のようになる。

```json
"プロジェクトURL": "ams:projectid",
"プロジェクトURL.関連識別子.関連識別子": "ams:projectid.value",
"プロジェクトURL.関連タイプ": "$isVersionOf",
```

### 2. WEKOのアイテムからRO-Crateへの変換

WEKOのRO-Crateマッピング機能を使用し、関連識別子と関連タイプを以下のキーにマッピングする。  

- 関連識別子
  - ツリー構造: root > プロジェクトURL > URL > URL
  - RO-Crateのキー: `text`
- 関連タイプ
  - ツリー構造: root > プロジェクトURL > 関連タイプ > 関連タイプ
  - RO-Crateのキー: `text`

### 3. フロントでのGRDMボタン表示

WEKOのアイテム詳細情報取得APIを使用し、RO-Crateから関連識別子と関連タイプを取得する。  
関連識別子と関連タイプが取得でき、以下の条件をみたす場合、プロジェクトURLとして扱う。

- 関連識別子がGRDMのURL(<https://rdm.nii.ac.jp>)で始まる、または任意のURL(未定)
- 関連タイプが`xxx`(未定)である

プロジェクトURLが設定されている場合、ユーザのログイン状態に関わらずアイテム詳細画面にGRDMボタンを表示する。  
ユーザがGRDMボタンを押下した場合は、プロジェクトURLを新規ウィンドウで開く。  
GRDMボタンを表示している場合、リクエストボタンとその表示領域は非表示とする。

### 更新履歴

| 日付         | GitHubコミットID | 更新内容   |
|--------------|------------------|------------|
| 2025/06/13   |                  | 初版作成   |
