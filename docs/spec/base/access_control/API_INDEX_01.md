# インデックス

インデックスに関するAPIのアクセスコントロールについて記述します。

## 目次

- [GET /api/\<version>/tree](#get-apiversiontree)
- [GET /api/\<version>/tree/<index_id>](#get-apiversiontreeindex_id)
- [GET /api/\<version>/tree/index](#get-apiversiontreeindex)
- [GET /api/\<version>/tree/index/\<index_id>](#get-apiversiontreeindexindex_id)
- [GET /api/\<version>/tree/index/\<index_id>/parent](#get-apiversiontreeindexindex_idparent)
- [POST /api/\<version>/tree/index](#post-apiversiontreeindex)
- [PUT /api/\<version>/tree/index/<index_id>](#put-apiversiontreeindexindex_id)
- [DELETE /api/\<version>/tree/index/<index_id>](#delete-apiversiontreeindexindex_id)

## GET /api/\<version>/tree

表内のいずれかの○に合致すれば、インデックス情報を取得することが出来ます。

| 条件/ロール                                  | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>index:read<br>がある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                     | ×                  | ×                    | ×                      | ×            | ×            | ×                        |

※ インデックスの閲覧可否は画面からのアクセスと同一条件です。<br>
　[インデックス閲覧権限](USER_ITEM_SEARCH_01.md#インデックス閲覧権限)を参照ください。

## GET /api/\<version>/tree/\<index_id>

表内のいずれかの○に合致すれば、指定したインデックスIDのインデックスツリーを取得することが出来ます。

| 条件/ロール                                  | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>index:read<br>がある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                     | ×                  | ×                    | ×                      | ×            | ×            | ×                        |

※ インデックスの閲覧可否は画面からのアクセスと同一条件です。<br>
　[インデックス閲覧権限](USER_ITEM_SEARCH_01.md#インデックス閲覧権限)を参照ください。

## GET /api/\<version>/tree/index

表内のいずれかの○に合致すれば、インデックス情報を取得することが出来ます。

| 条件/ロール                                  | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>index:read<br>がある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                     | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

※ インデックスの閲覧可否は画面からのアクセスと同一条件です。<br>
　[インデックス閲覧権限](USER_ITEM_SEARCH_01.md#インデックス閲覧権限)を参照ください。

## GET /api/\<version>/tree/index/\<index_id><br>

表内のいずれかの○に合致すれば、指定したインデックスIDのインデックスツリーを取得することが出来ます。

| 条件/ロール                                  | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>index:read<br>がある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                     | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

※ インデックスの閲覧可否は画面からのアクセスと同一条件です。<br>
　[インデックス閲覧権限](USER_ITEM_SEARCH_01.md#インデックス閲覧権限)を参照ください。

## GET /api/\<version>/tree/index/\<index_id>/parent

表内のいずれかの○に合致すれば、指定したインデックスIDとルートまでの親インデックス一覧を取得することが出来ます。

| 条件/ロール                                  | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>index:read<br>がある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                     | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

※ インデックスの閲覧可否は画面からのアクセスと同一条件です。<br>
　[インデックス閲覧権限](USER_ITEM_SEARCH_01.md#インデックス閲覧権限)を参照ください。

## POST /api/\<version>/tree/index

インデックス登録APIを使用するためには2つの条件を満たす必要があります。

以下2つの条件の一方でも×なら利用不可、どちらも○であればインデックスを新規作成することが出来ます。

条件1 作成するインデックスの親

| 条件1/ロール                     | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 自身の管理する<br>インデックス   | ○                  | ○                    | ○                      | ×            | ×            | ×                        |
| 自身の管理しない<br>インデックス | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

条件2 トークンのスコープ

| 条件2/ロール           | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ---------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| index:create<br>がある | ○                  | ○                    | ○                      | ×            | ×            | ×                        |
| 上記以外               | ×                  | ×                    | ×                      | ×            | ×            | ×                        |

## PUT /api/\<version>/tree/index/<index_id>

インデックス更新APIを使用するためには2つの条件を満たす必要があります。

以下2つの条件の一方でも×なら利用不可、どちらも○であれば指定したインデックスを更新することが出来ます。

条件1 作成するインデックスの親

| 条件1/ロール                     | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 自身の管理する<br>インデックス   | ○                  | ○                    | ○                      | ×            | ×            | ×                        |
| 自身の管理しない<br>インデックス | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

条件2 トークンのスコープ

| 条件2/ロール           | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ---------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| index:update<br>がある | ○                  | ○                    | ○                      | ×            | ×            | ×                        |
| 上記以外               | ×                  | ×                    | ×                      | ×            | ×            | ×                        |

## DELETE /api/\<version>/tree/index/<index_id>

インデックス削除APIを使用するためには2つの条件を満たす必要があります。

以下2つの条件の一方でも×なら利用不可、どちらも○であれば指定したインデックスを削除することが出来ます。

条件1 自身の管理するインデックスか否か

| 条件1/ロール                     | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 自身の管理する<br>インデックス   | ○                  | ○                    | ○                      | ×            | ×            | ×                        |
| 自身の管理しない<br>インデックス | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

条件2 トークンのスコープ

| 条件2/ロール           | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ---------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| index:delete<br>がある | ○                  | ○                    | ○                      | ×            | ×            | ×                        |
| 上記以外               | ×                  | ×                    | ×                      | ×            | ×            | ×                        |

## 更新履歴

| 日付       | GitHubコミットID                           | 更新内容                                                 |
| ---------- | ------------------------------------------ | -------------------------------------------------------- |
| 2025/08/29 |    6ee63da44c8f2e23ac73d6218ee09f23ba5edcb3      | 初版作成                                                 |
