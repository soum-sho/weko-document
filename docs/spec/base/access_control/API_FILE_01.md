# ファイル

ファイルに関するAPIのアクセスコントロールについて記述します。

## 目次

- [GET /api/\<version>/ranking/<pid_value>/files](#get-apiversionrankingpid_valuefiles)
- [GET /api/\<version>/records/<pid_value>/files/\<filename>](#get-apiversionrecordspid_valuefilesfilename)
- [GET /api/\<version>/records/<pid_value>/files/\<filename>/stats](#get-apiversionrecordspid_valuefilesfilenamestats)
- [GET /api/\<version>/records/<pid_value>/files/all](#get-apiversionrecordspid_valuefilesall)
- [POST /api/\<version>/records/<pid_value>/files/selected](#post-apiversionrecordspid_valuefilesselected)
- [GET /api/\<version>/ranking/<ranking_type>](#get-apiversionrankingranking_type)

## GET /api/\<version>/ranking/<pid_value>/files

#### APIの使用

いずれかの○に合致すれば、ファイルのランキング情報を取得するAPIを使用することが出来ます。

| 条件/ロール                                | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ------------------------------------------ | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>ranking:readがある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                   | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

#### ランキングのファイル表示可否

ファイルAPIにおける[ファイル閲覧権限](#ファイル閲覧権限)があれば、ランキングにファイルが表示されます。

| 条件/ロール                | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| ファイル閲覧権限：<br>あり | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| ファイル閲覧権限：<br>なし | ー                 | ー                   | ×                      | ×            | ×            | ×                        |

## GET /api/\<version>/records/<pid_value>/files/\<filename>

#### APIの使用

いずれかの○に合致すれば、ファイルを取得するAPIを使用することが出来ます。

| 条件/ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| --------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>user:readがある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

#### ファイル取得可否

ファイルAPIにおける[ファイル閲覧権限](#ファイル閲覧権限)があれば、ファイルを取得出来ます。

| 条件/ロール                | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| ファイル閲覧権限：<br>あり | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| ファイル閲覧権限：<br>なし | ー                 | ー                   | ×                      | ×            | ×            | ×                        |

## GET /api/\<version>/records/<pid_value>/files/\<filename>/stats

#### APIの使用

いずれかの○に合致すれば、レコード統計を取得するAPIを使用することが出来ます。

| 条件/ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| --------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>file:readがある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

#### 統計取得可否

ファイルAPIにおける[ファイル閲覧権限](#ファイル閲覧権限)があれば、統計を取得出来ます。

| 条件/ロール                | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| ファイル閲覧権限：<br>あり | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| ファイル閲覧権限：<br>なし | ー                 | ー                   | ×                      | ×            | ×            | ×                        |

## GET /api/\<version>/records/<pid_value>/files/all

#### APIの使用

いずれかの○に合致すれば、全ファイルの一覧情報を取得するAPIを使用することが出来ます。

| 条件/ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| --------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>file:readがある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

#### 一覧情報にファイルが含まれるか否か

ファイルAPIにおける[ファイル閲覧権限](#ファイル閲覧権限)があれば、一覧情報にファイルが含まれます。

| 条件/ロール                | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| ファイル閲覧権限：<br>あり | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| ファイル閲覧権限：<br>なし | ー                 | ー                   | ×                      | ×            | ×            | ×                        |

## POST /api/\<version>/records/<pid_value>/files/selected

#### APIの使用

いずれかの○に合致すれば、指定レコードの選択ファイルの一覧を取得することが出来ます。

| 条件/ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| --------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>file:readがある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

#### ファイル取得可否

ファイルAPIにおける[ファイル閲覧権限](#ファイル閲覧権限)があれば、ファイルを取得出来ます。

| 条件/ロール                | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| ファイル閲覧権限：<br>あり | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| ファイル閲覧権限：<br>なし | ー                 | ー                   | ×                      | ×            | ×            | ×                        |

## GET /api/\<version>/ranking/<ranking_type>

#### APIの使用

いずれかの○に合致すれば、ランキング情報を取得することが出来ます。

| 条件/ロール                                | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ------------------------------------------ | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| トークンのスコープに<br>ranking:readがある | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 上記以外                                   | ×                  | ×                    | ×                      | ×            | ×            | ○                        |

#### ランキングにアイテム表示可否

ユーザー画面のランキング(/items/ranking)でアイテムがランキングに表示される条件と同一の条件を満たしていればアイテムが表示されます。<br>
[ランキング表示](USER_ITEM_RANKING_01.md#ランキング表示)を参照ください。

| ロール                   | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ------------------------ | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| ランキング表示：<br>可   | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| ランキング表示：<br>不可 | ー                 | ー                   | ×                      | ×            | ×            | ×                        |

※ インデックスの閲覧権限有無は[インデックス閲覧権限](USER_ITEM_SEARCH_01.md#インデックス閲覧権限)を参照ください。

## ファイル閲覧権限

ファイルAPIにおけるファイル閲覧権限は、以下の2条件のどちらかを満たす必要があります。

2条件の一方でも○なら閲覧可、どちらも×なら閲覧不可です。

#### 条件1 アイテム閲覧権限(※1)とファイル公開設定

条件1-1 アイテム閲覧権限：有 / ファイル公開設定：オープンアクセス、オープンアクセス日を指定する（指定日以降）

| ロール | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ------ | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
|        | ○                  | ○                    | ○                      | ○            | ○            | ○                        |

条件1-2 アイテム閲覧権限：無 / ファイル公開設定：オープンアクセス、オープンアクセス日を指定する（指定日以前・以降）、ログインユーザーのみ、非公開

| ロール | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ------ | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
|        | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

条件1-3 アイテム閲覧権限：有 / ファイル公開設定：オープンアクセス日を指定する（指定日以前）、非公開

| ロール | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ------ | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
|        | ○                  | ○                    | ○                      | ×            | ×            | ×                        |

条件1-4 アイテム閲覧権限：有 / ファイル公開設定：ログインユーザーのみ

| ロール | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ------ | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
|        | ○                  | ○                    | ○                      | ○            | ○            | ×                        |

※1 アイテムAPIにおけるアイテム閲覧権限を指します。<br>
　　[アイテム閲覧権限](API_ITEM_01.md#アイテムapiのアイテム閲覧権限)を参照ください。

#### 条件2 アイテム作成者または代理投稿者が自分

| 条件2/ロール | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ------------ | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 自分         | ○                  | ○                    | ○                      | ○            | ○            | ×                        |
| 自分以外     | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

- > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2025/8/8</p>
</blockquote></td>
<td></td>
<td>初版作成</td>
</tr>
</tbody>
</table>
