# 検索画面

検索画面のアクセスコントロールについて記述します。

エンドポイント：（/search）

## 目次

- [簡易検索](#簡易検索)
- [詳細検索](#詳細検索)
- [ファセット検索](#ファセット検索)
- [インデックス閲覧権限](#インデックス閲覧権限)

## 簡易検索

検索結果に表示されるかどうかは、インデックスの閲覧権限、およびアイテムの公開日と公開ステータスの条件によって決まります。

#### ① インデックス閲覧権限がある場合

以下の条件1,2のどちらかが○なら検索結果に表示され、両方×なら表示されません。

| 条件1 /ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ----------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 公開日以降かつ<br>公開ステータス：Publish | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| 上記を満たさない                          | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

| 条件2 /ロール                    | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者※1 | 登録ユーザー※1 | 一般ユーザー※2 | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ------------------------ | -------------- | -------------- | ------------------------ |
| 作成者または<br>代理投稿者が自身 | ○                  | ○                    | ○                        | ○              | ×              | ×                        |
| 上記を満たさない                 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |

#### ② インデックス閲覧権限がない場合

以下の条件1,2のどちらかが○なら検索結果に表示され、両方×なら表示されません。

| 条件1 /ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ----------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 公開日以降かつ<br>公開ステータス：Publish | ○                  | ○                    | ×                      | ×            | ×            | ×                        |
| 上記を満たさない                          | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

| 条件2 /ロール                    | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者※1 | 登録ユーザー※1 | 一般ユーザー※2 | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ------------------------ | -------------- | -------------- | ------------------------ |
| 作成者または<br>代理投稿者が自身 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |
| 上記を満たさない                 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |

※1 厳密には管理画面のユーザー管理 > アクセス: ロールでsearch-accessのActionが与えられたロールを指します。

※2 厳密には管理画面のユーザー管理 > アクセス: ロールでsearch-accessのActionが与えられていないロールを指します。

※ インデックス閲覧権限については [インデックス閲覧権限](#インデックス閲覧権限)の項目を参照してください。

## 詳細検索

検索結果に表示されるかどうかは、インデックスの閲覧権限、およびアイテムの公開日と公開ステータスの条件によって決まります。

#### ① インデックス閲覧権限がある場合

以下の条件1,2のどちらかが○なら検索結果に表示され、両方×なら表示されません。

| 条件1 /ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ----------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 公開日以降かつ<br>公開ステータス：Publish | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| 上記を満たさない                          | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

| 条件2 /ロール                    | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者※1 | 登録ユーザー※1 | 一般ユーザー※2 | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ------------------------ | -------------- | -------------- | ------------------------ |
| 作成者または<br>代理投稿者が自身 | ○                  | ○                    | ○                        | ○              | ×              | ×                        |
| 上記を満たさない                 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |

#### ② インデックス閲覧権限がない場合

以下の条件1,2のどちらかが○なら検索結果に表示され、両方×なら表示されません。

| 条件1 /ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ----------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 公開日以降かつ<br>公開ステータス：Publish | ○                  | ○                    | ×                      | ×            | ×            | ×                        |
| 上記を満たさない                          | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

| 条件2 /ロール                    | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者※1 | 登録ユーザー※1 | 一般ユーザー※2 | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ------------------------ | -------------- | -------------- | ------------------------ |
| 作成者または<br>代理投稿者が自身 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |
| 上記を満たさない                 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |

※1 厳密には管理画面のユーザー管理 > アクセス: ロールでsearch-accessのActionが与えられたロールを指します。

※2 厳密には管理画面のユーザー管理 > アクセス: ロールでsearch-accessのActionが与えられていないロールを指します。

※ インデックス閲覧権限については [インデックス閲覧権限](#インデックス閲覧権限)の項目を参照してください。

## ファセット検索

検索結果に表示されるかどうかは、インデックスの閲覧権限、およびアイテムの公開日と公開ステータスの条件によって決まります。

#### ① インデックス閲覧権限がある場合

以下の条件1,2のどちらかが○なら検索結果に表示され、両方×なら表示されません。

| 条件1 /ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ----------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 公開日以降かつ<br>公開ステータス：Publish | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| 上記を満たさない                          | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

| 条件2 /ロール                    | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者※1 | 登録ユーザー※1 | 一般ユーザー※2 | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ------------------------ | -------------- | -------------- | ------------------------ |
| 作成者または<br>代理投稿者が自身 | ○                  | ○                    | ○                        | ○              | ×              | ×                        |
| 上記を満たさない                 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |

#### ② インデックス閲覧権限がない場合

以下の条件1,2のどちらかが○なら検索結果に表示され、両方×なら表示されません。

| 条件1 /ロール                             | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ----------------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 公開日以降かつ<br>公開ステータス：Publish | ○                  | ○                    | ×                      | ×            | ×            | ×                        |
| 上記を満たさない                          | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

| 条件2 /ロール                    | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者※1 | 登録ユーザー※1 | 一般ユーザー※2 | ゲスト<br>（未ログイン） |
| -------------------------------- | ------------------ | -------------------- | ------------------------ | -------------- | -------------- | ------------------------ |
| 作成者または<br>代理投稿者が自身 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |
| 上記を満たさない                 | ○                  | ○                    | ×                        | ×              | ×              | ×                        |

※1 厳密には管理画面のユーザー管理 > アクセス：ロールでsearch-accessのActionが与えられたロールを指します。

※2 厳密には管理画面のユーザー管理 > アクセス：ロールでsearch-accessのActionが与えられていないロールを指します。

※ インデックス閲覧権限については [インデックス閲覧権限](#インデックス閲覧権限)の項目を参照してください。

## インデックス閲覧権限

インデックスの閲覧権限を得るには、条件1～4のすべてを満たす必要があります。

一つでも×があれば閲覧不可、すべて○であれば閲覧が可能です。

条件1 インデックス公開ステータス

| 条件/ロール | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ----------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 公開        | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| 非公開      | ○                  | ○                    | ○ ※1                   | ×            | ×            | ×                        |

※1 自身が管理するインデックスに限ります。

条件2 公開日前/後

| 条件/ロール                        | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ---------------------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 公開前                             | ○                  | ○                    | ○ ※1                   | ×            | ×            | ×                        |
| 公開後、または<br>公開日：指定なし | ○                  | ○                    | ○                      | ○            | ○            | ○                        |

※1 自身が管理するインデックスに限ります。

条件3 親インデックス閲覧可否

| 条件/ロール | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| ----------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 可          | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| 不可        | ○                  | ○                    | ×                      | ×            | ×            | ×                        |

条件4 ユーザーの持つロールがすべて「権限あり」に設定されている、またはユーザーの持つグループの1個以上が「権限あり」に設定されている ※1

| 条件/ロール          | システム<br>管理者 | リポジトリ<br>管理者 | コミュニティ<br>管理者 | 登録ユーザー | 一般ユーザー | ゲスト<br>（未ログイン） |
| -------------------- | ------------------ | -------------------- | ---------------------- | ------------ | ------------ | ------------------------ |
| 設定されて<br>いる   | ○                  | ○                    | ○                      | ○            | ○            | ○                        |
| 設定されて<br>いない | ○                  | ○                    | ○ ※2                   | ×            | ×            | ×                        |

※1 「権限あり」とは、管理画面のインデックスツリー管理 ＞ ツリー編集 でインデックスごとに設定出来る「閲覧権限」の値です。

※2 自身が管理するインデックスに限ります。

## 更新履歴

| 日付       | GitHubコミットID                           | 更新内容                                                 |
| ---------- | ------------------------------------------ | -------------------------------------------------------- |
| 2025/08/29 |    6ee63da44c8f2e23ac73d6218ee09f23ba5edcb3      | 初版作成                                                 |
