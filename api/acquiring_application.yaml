openapi: 3.0.3
info:
  title: 利用申請を行うのためのWEB API
  version: "1.0"
tags:
  - name: files
    description: ファイル情報
  - name: workflow
    description: ワークフロー
paths:
  /api/{version}/records/{pid}/files/{filename}/terms:
    get:
      tags:
        - files
      summary: 利用規約取得
      description: |-
        指定したファイルの利用規約取得
        |ロール|動作|
        |----|----|
        |システム管理者|使用可能|
        |リポジトリ管理者|使用可能|
        |コミュニティ管理者|使用可能|
        |登録ユーザー|使用可能|
        |一般ユーザー|使用可能| 
        |ゲストユーザー|使用可能|
      parameters:
        - name: version
          in: path
          description: このAPIのバージョン情報
          required: true
          schema:
            type: string
          example: v1
        - name: pid
          in: path
          description: レコードを一意に識別するID
          required: true
          schema:
            type: integer
          example: 1
        - name: filename
          in: path
          description: ファイル名
          required: true
          schema:
            type: string
          example: main.pdf
        - name: Authorization
          in: header
          description: 認可情報
          schema:
            type: string
            example: Bearer アクセストークン
        - name: If-None-Match
          in: header
          description: 1回目のレスポンスヘッダーETagに設定された値
          schema:
            type: string
        - name: Accept-Language
          in: header
          description: 言語
          schema:
            type: string
            default: en
        - name: pretty
          in: query
          description: レスポンスの整形
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: 取得成功
          headers:
            Etag:
              description: 利用規約内容を示すハッシュ値
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  text:
                    description: 利用規約テキスト
                    type: string
                  Etag:
                    description: 利用規約内容を示すハッシュ値
                    type: string
        "304":
          description: 前回取得時から更新なし
        "401":
          description: OAuth2認証失敗
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "404":
          description: |-
            存在しない  
            ・アイテムが存在しない
            ・ファイルが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "429":
          description: |-
            リクエスト制限  
            ・リミットレートを超えてアクセスされた
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
      security:
        - OAuth2: ["user:activity"]
  
  /api/{version}/records/{pid}/files/{filename}/application:
    post:
      tags:
        - files
      summary: 利用申請開始API
      description: |-
        制限公開ファイルの利用申請を開始し、アクティビティ作成を行う
        |ロール|動作|
        |----|----|
        |システム管理者|使用可能|
        |リポジトリ管理者|使用可能|
        |コミュニティ管理者|使用可能|
        |登録ユーザー|使用可能|
        |一般ユーザー|使用可能|
        |ゲストユーザー|使用可能|
      parameters:
        - name: version
          in: path
          description: このAPIのバージョン情報
          required: true
          schema:
            type: string
          example: v1
        - name: pid
          in: path
          description: レコードを一意に識別するID
          required: true
          schema:
            type: integer
          example: 1
        - name: filename
          in: path
          description: ファイル名
          required: true
          schema:
            type: string
          example: main.pdf
        - name: Authorization
          in: header
          description: 認可情報
          schema:
            type: string
            example: Bearer アクセストークン
        - name: Accept-Language
          in: header
          description: 言語
          schema:
            type: string
            default: en
        - name: pretty
          in: query
          description: レスポンスの整形
          schema:
            type: boolean
            default: false
        - name: terms_token
          in: query
          description: 利用規約取得APIのEtagに設定された値
          schema:
            type: string
        - name: mail
          in: query
          description: ユーザのメールアドレス（ゲストユーザの場合のみ）
          schema:
            type: string
      responses:
        "200":
          description: アクティビティ作成成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  activity_id:
                    type: string
                    description: アクティビティID
                    example: A-20230803-00001
                  activity_url:
                    type: string
                    description: アクティビティURL（UIアクセス用）
                    example: https://192.168.56.101/workflow/activity/guest-user/main.pdf?token=QS0yMDIzMDgwMy0wMDAwMSAyMDIzLTA4LTAzIGF0c3VzaGkuc3V6dWtpQGl2aXMuY28uanAgMkEyM0RFMEY1ODI0QjU2RQ==",
                  item_type_schema:
                    type: object
                    description: ItemRegistrationの入力項目（アイテムタイプスキーマ）
                    example: {
                              "$schema": "http://json-schema.org/draft-04/schema#",
                              "description": "",
                              "properties": {
                                "item_1616221831877": {
                                    "properties": {
                                        "subitem_restricted_access_dataset_usage": {
                                            "format": "text",
                                            "title": "Dataset Usage",
                                            "title_i18n": {
                                                "en": "Dataset Usage",
                                                "ja": "データ名"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Dataset Usage",
                                                "ja": "データ名"
                                            },
                                            "type": "string"
                                        }
                                    },
                                    "title": "Dataset Usage",
                                    "type": "object"
                                },
                                "item_1616221851421": {
                                    "properties": {
                                        "subitem_affiliated_division/department": {
                                            "format": "text",
                                            "title": "Affiliated Division/Department",
                                            "title_i18n": {
                                                "en": "Affiliated Division/Department",
                                                "ja": "所属部局・部署"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Affiliated Division/Department",
                                                "ja": "所属部局・部署"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_fullname": {
                                            "format": "text",
                                            "title": "Name",
                                            "title_i18n": {
                                                "en": "Name",
                                                "ja": "名前"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Name",
                                                "ja": "名前"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_mail_address": {
                                            "format": "text",
                                            "title": "Mail Address",
                                            "title_i18n": {
                                                "en": "Mail Address",
                                                "ja": "メールアドレス"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Mail Address",
                                                "ja": "メールアドレス"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_phone_number": {
                                            "format": "text",
                                            "title": "Phone Number",
                                            "title_i18n": {
                                                "en": "Phone Number",
                                                "ja": "電話番号"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Phone Number",
                                                "ja": "電話番号"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_position": {
                                            "currentEnum": [],
                                            "format": "select",
                                            "title": "Position",
                                            "type": [
                                                "null",
                                                "string"
                                            ]
                                        },
                                        "subitem_position(others)": {
                                            "format": "text",
                                            "title": "Position(Others)",
                                            "title_i18n": {
                                                "en": "Position(Others)",
                                                "ja": "役職（その他）"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Position(Others)",
                                                "ja": "役職（その他）"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_university/institution": {
                                            "format": "text",
                                            "title": "University/Institution",
                                            "title_i18n": {
                                                "en": "University/Institution",
                                                "ja": "所属大学・機関"
                                            },
                                            "title_i18n_temp": {
                                                "en": "University/Institution",
                                                "ja": "所属大学・機関"
                                            },
                                            "type": "string"
                                        }
                                    },
                                    "title": "Applicant",
                                    "type": "object"
                                },
                                "item_1616221894659": {
                                    "items": {
                                        "properties": {
                                            "subitem_restricted_access_institution_name": {
                                                "format": "text",
                                                "title": "Institution Name",
                                                "title_i18n": {
                                                    "en": "Institution Name",
                                                    "ja": "所属学会名"
                                                },
                                                "title_i18n_temp": {
                                                    "en": "Institution Name",
                                                    "ja": "所属学会名"
                                                },
                                                "type": "string"
                                            },
                                            "subitem_restricted_access_institution_position": {
                                                "currentEnum": [],
                                                "format": "select",
                                                "title": "Institution Position",
                                                "type": [
                                                    "null",
                                                    "string"
                                                ]
                                            }
                                        },
                                        "type": "object"
                                    },
                                    "maxItems": 9999,
                                    "minItems": 1,
                                    "title": "Applicant Affiliated Institution",
                                    "type": "array"
                                },
                                "item_1616221921931": {
                                    "properties": {
                                        "subitem_restricted_access_usage_report_id": {
                                            "format": "text",
                                            "title": "Usage Report ID",
                                            "title_i18n": {
                                                "en": "Usage Report ID",
                                                "ja": "利用報告ID "
                                            },
                                            "title_i18n_temp": {
                                                "en": "Usage Report ID",
                                                "ja": "利用報告ID "
                                            },
                                            "type": "string"
                                        }
                                    },
                                    "title": "Usage Report ID",
                                    "type": "object"
                                },
                                "item_1616221941275": {
                                    "properties": {
                                        "subitem_restricted_access_research_title": {
                                            "format": "text",
                                            "title": "Research Title",
                                            "title_i18n": {
                                                "en": "Research Title",
                                                "ja": "研究題目"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Research Title",
                                                "ja": "研究題目"
                                            },
                                            "type": "string"
                                        }
                                    },
                                    "title": "Research Title",
                                    "type": "object"
                                },
                                "item_1616221960771": {
                                    "properties": {
                                        "subitem_restricted_access_research_plan": {
                                            "format": "textarea",
                                            "title": "Research Plan",
                                            "title_i18n": {
                                                "en": "Research Plan",
                                                "ja": "研究計画"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Research Plan",
                                                "ja": "研究計画"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_restricted_access_research_plan_type": {
                                            "currentEnum": [
                                                "Abstract"
                                            ],
                                            "default": "Abstract",
                                            "enum": [
                                                null,
                                                "Abstract"
                                            ],
                                            "format": "select",
                                            "title": "Research Plan Type",
                                            "type": [
                                                "null",
                                                "string"
                                            ]
                                        }
                                    },
                                    "title": "Research Plan",
                                    "type": "object"
                                },
                                "item_1616221987611": {
                                    "items": {
                                        "properties": {
                                            "accessrole": {
                                                "enum": [
                                                    "open_access",
                                                    "open_date",
                                                    "open_login",
                                                    "open_no"
                                                ],
                                                "format": "radios",
                                                "title": "アクセス",
                                                "type": [
                                                    "null",
                                                    "string"
                                                ]
                                            },
                                            "date": {
                                                "format": "array",
                                                "items": {
                                                    "format": "object",
                                                    "properties": {
                                                        "dateType": {
                                                            "currentEnum": [],
                                                            "format": "select",
                                                            "title": "日付タイプ",
                                                            "type": [
                                                                "null",
                                                                "string"
                                                            ]
                                                        },
                                                        "dateValue": {
                                                            "format": "datetime",
                                                            "title": "日付",
                                                            "title_i18n": {
                                                                "en": "",
                                                                "ja": ""
                                                            },
                                                            "type": "string"
                                                        }
                                                    },
                                                    "type": "object"
                                                },
                                                "title": "オープンアクセスの日付",
                                                "type": "array"
                                            },
                                            "displaytype": {
                                                "currentEnum": [
                                                    "detail",
                                                    "simple",
                                                    "preview"
                                                ],
                                                "enum": [
                                                    null,
                                                    "detail",
                                                    "simple",
                                                    "preview"
                                                ],
                                                "format": "select",
                                                "title": "表示形式",
                                                "type": [
                                                    "null",
                                                    "string"
                                                ]
                                            },
                                            "fileDate": {
                                                "format": "array",
                                                "items": {
                                                    "format": "object",
                                                    "properties": {
                                                        "fileDateType": {
                                                            "currentEnum": [
                                                                "Accepted",
                                                                "Collected",
                                                                "Copyrighted",
                                                                "Issued",
                                                                "Submitted",
                                                                "Updated",
                                                                "Valid"
                                                            ],
                                                            "enum": [
                                                                null,
                                                                "Accepted",
                                                                "Collected",
                                                                "Copyrighted",
                                                                "Issued",
                                                                "Submitted",
                                                                "Updated",
                                                                "Valid"
                                                            ],
                                                            "format": "select",
                                                            "title": "日付タイプ",
                                                            "type": [
                                                                "null",
                                                                "string"
                                                            ]
                                                        },
                                                        "fileDateValue": {
                                                            "format": "datetime",
                                                            "title": "日付",
                                                            "title_i18n": {
                                                                "en": "Date",
                                                                "ja": "日付"
                                                            },
                                                            "title_i18n_temp": {
                                                                "en": "Date",
                                                                "ja": "日付"
                                                            },
                                                            "type": "string"
                                                        }
                                                    },
                                                    "type": "object"
                                                },
                                                "title": "日付",
                                                "type": "array"
                                            },
                                            "filename": {
                                                "format": "text",
                                                "title": "表示名",
                                                "title_i18n": {
                                                    "en": "FileName",
                                                    "ja": "表示名"
                                                },
                                                "title_i18n_temp": {
                                                    "en": "FileName",
                                                    "ja": "表示名"
                                                },
                                                "type": [
                                                    "null",
                                                    "string"
                                                ]
                                            },
                                            "filesize": {
                                                "format": "array",
                                                "items": {
                                                    "format": "object",
                                                    "properties": {
                                                        "value": {
                                                            "format": "text",
                                                            "title": "サイズ",
                                                            "title_i18n": {
                                                                "en": "Size",
                                                                "ja": "サイズ"
                                                            },
                                                            "title_i18n_temp": {
                                                                "en": "Size",
                                                                "ja": "サイズ"
                                                            },
                                                            "type": "string"
                                                        }
                                                    },
                                                    "type": "object"
                                                },
                                                "title": "サイズ",
                                                "type": "array"
                                            },
                                            "format": {
                                                "format": "text",
                                                "title": "フォーマット",
                                                "title_i18n": {
                                                    "en": "Format",
                                                    "ja": "フォーマット"
                                                },
                                                "title_i18n_temp": {
                                                    "en": "Format",
                                                    "ja": "フォーマット"
                                                },
                                                "type": "string"
                                            },
                                            "groups": {
                                                "currentEnum": [],
                                                "format": "select",
                                                "title": "グループ",
                                                "type": [
                                                    "null",
                                                    "string"
                                                ]
                                            },
                                            "licensefree": {
                                                "format": "textarea",
                                                "title": "自由ライセンス",
                                                "title_i18n": {
                                                    "en": "自由ライセンス",
                                                    "ja": "自由ライセンス"
                                                },
                                                "type": "string"
                                            },
                                            "licensetype": {
                                                "currentEnum": [],
                                                "format": "select",
                                                "title": "ライセンス",
                                                "type": [
                                                    "null",
                                                    "string"
                                                ]
                                            },
                                            "url": {
                                                "format": "object",
                                                "properties": {
                                                    "label": {
                                                        "format": "text",
                                                        "title": "ラベル",
                                                        "title_i18n": {
                                                            "en": "Label",
                                                            "ja": "ラベル"
                                                        },
                                                        "title_i18n_temp": {
                                                            "en": "Label",
                                                            "ja": "ラベル"
                                                        },
                                                        "type": "string"
                                                    },
                                                    "objectType": {
                                                        "currentEnum": [
                                                            "abstract",
                                                            "dataset",
                                                            "fulltext",
                                                            "software",
                                                            "summary",
                                                            "thumbnail",
                                                            "other"
                                                        ],
                                                        "enum": [
                                                            null,
                                                            "abstract",
                                                            "dataset",
                                                            "fulltext",
                                                            "software",
                                                            "summary",
                                                            "thumbnail",
                                                            "other"
                                                        ],
                                                        "format": "select",
                                                        "title": "オブジェクトタイプ",
                                                        "type": [
                                                            "null",
                                                            "string"
                                                        ]
                                                    },
                                                    "url": {
                                                        "format": "text",
                                                        "title": "本文URL",
                                                        "title_i18n": {
                                                            "en": "Text URL",
                                                            "ja": "本文URL"
                                                        },
                                                        "title_i18n_temp": {
                                                            "en": "Text URL",
                                                            "ja": "本文URL"
                                                        },
                                                        "type": "string"
                                                    }
                                                },
                                                "title": "本文URL",
                                                "type": "object"
                                            },
                                            "version": {
                                                "format": "text",
                                                "title": "バージョン情報",
                                                "title_i18n": {
                                                    "en": "Version Information",
                                                    "ja": "バージョン情報"
                                                },
                                                "title_i18n_temp": {
                                                    "en": "Version Information",
                                                    "ja": "バージョン情報"
                                                },
                                                "type": "string"
                                            }
                                        },
                                        "type": "object"
                                    },
                                    "maxItems": 9999,
                                    "minItems": 1,
                                    "title": "Co-user List",
                                    "type": "array"
                                },
                                "item_1616222047122": {
                                    "properties": {
                                        "subitem_restricted_access_wf_issued_date": {
                                            "format": "datetime",
                                            "title": "WF Issued Date",
                                            "title_i18n": {
                                                "en": "WF Issued Date",
                                                "ja": "WF起票日"
                                            },
                                            "title_i18n_temp": {
                                                "en": "WF Issued Date",
                                                "ja": "WF起票日"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_restricted_access_wf_issued_date_type": {
                                            "currentEnum": [
                                                "Created"
                                            ],
                                            "default": "Created",
                                            "enum": [
                                                null,
                                                "Created"
                                            ],
                                            "format": "select",
                                            "title": "WF Issued Date Type",
                                            "type": [
                                                "null",
                                                "string"
                                            ]
                                        }
                                    },
                                    "title": "WF Issued Date",
                                    "type": "object"
                                },
                                "item_1616222067301": {
                                    "properties": {
                                        "subitem_restricted_access_application_date": {
                                            "format": "datetime",
                                            "title": "Application Date",
                                            "title_i18n": {
                                                "en": "Application Date",
                                                "ja": "申請日"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Application Date",
                                                "ja": "申請日"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_restricted_access_application_date_type": {
                                            "currentEnum": [
                                                "Issued"
                                            ],
                                            "default": "Issued",
                                            "enum": [
                                                null,
                                                "Issued"
                                            ],
                                            "format": "select",
                                            "title": "Application Date Type",
                                            "type": [
                                                "null",
                                                "string"
                                            ]
                                        }
                                    },
                                    "title": "Application Date",
                                    "type": "object"
                                },
                                "item_1616222093486": {
                                    "properties": {
                                        "subitem_restricted_access_approval_date": {
                                            "format": "datetime",
                                            "title": "Approval Date",
                                            "title_i18n": {
                                                "en": "Approval Date",
                                                "ja": "承認日"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Approval Date",
                                                "ja": "承認日"
                                            },
                                            "type": "string"
                                        },
                                        "subitem_restricted_access_approval_date_type": {
                                            "currentEnum": [
                                                "Accepted"
                                            ],
                                            "default": "Accepted",
                                            "enum": [
                                                null,
                                                "Accepted"
                                            ],
                                            "format": "select",
                                            "title": "Approval Date Type",
                                            "type": [
                                                "null",
                                                "string"
                                            ]
                                        }
                                    },
                                    "title": "Approval Date",
                                    "type": "object"
                                },
                                "item_1616222117209": {
                                    "properties": {
                                        "subitem_restricted_access_item_title": {
                                            "format": "text",
                                            "title": "Item Title",
                                            "title_i18n": {
                                                "en": "Item Title",
                                                "ja": "アイテムタイトル"
                                            },
                                            "title_i18n_temp": {
                                                "en": "Item Title",
                                                "ja": "アイテムタイトル"
                                            },
                                            "type": "string"
                                        }
                                    },
                                    "title": "Item Title",
                                    "type": "object"
                                },
                                "pubdate": {
                                    "format": "datetime",
                                    "title": "PubDate",
                                    "type": "string"
                                },
                                "system_file": {
                                    "format": "object",
                                    "properties": {
                                        "subitem_systemfile_datetime": {
                                            "format": "array",
                                            "items": {
                                                "format": "object",
                                                "properties": {
                                                    "subitem_systemfile_datetime_date": {
                                                        "format": "datetime",
                                                        "title": "SYSTEMFILE DateTime Date",
                                                        "type": "string"
                                                    },
                                                    "subitem_systemfile_datetime_type": {
                                                        "enum": [
                                                            "Accepted",
                                                            "Available",
                                                            "Collected",
                                                            "Copyrighted",
                                                            "Created",
                                                            "Issued",
                                                            "Submitted",
                                                            "Updated",
                                                            "Valid"
                                                        ],
                                                        "format": "select",
                                                        "title": "SYSTEMFILE DateTime Type",
                                                        "type": "string"
                                                    }
                                                },
                                                "type": "object"
                                            },
                                            "title": "SYSTEMFILE DateTime",
                                            "type": "array"
                                        },
                                        "subitem_systemfile_filename": {
                                            "format": "array",
                                            "items": {
                                                "format": "object",
                                                "properties": {
                                                    "subitem_systemfile_filename_label": {
                                                        "format": "text",
                                                        "title": "SYSTEMFILE Filename Label",
                                                        "type": "string"
                                                    },
                                                    "subitem_systemfile_filename_type": {
                                                        "enum": [
                                                            "Abstract",
                                                            "Fulltext",
                                                            "Summary",
                                                            "Thumbnail",
                                                            "Other"
                                                        ],
                                                        "format": "select",
                                                        "title": "SYSTEMFILE Filename Type",
                                                        "type": "string"
                                                    },
                                                    "subitem_systemfile_filename_uri": {
                                                        "format": "text",
                                                        "title": "SYSTEMFILE Filename URI",
                                                        "type": "string"
                                                    }
                                                },
                                                "type": "object"
                                            },
                                            "title": "SYSTEMFILE Filename",
                                            "type": "array"
                                        },
                                        "subitem_systemfile_mimetype": {
                                            "format": "text",
                                            "title": "SYSTEMFILE MimeType",
                                            "type": "string"
                                        },
                                        "subitem_systemfile_size": {
                                            "format": "text",
                                            "title": "SYSTEMFILE Size",
                                            "type": "string"
                                        },
                                        "subitem_systemfile_version": {
                                            "format": "text",
                                            "title": "SYSTEMFILE Version",
                                            "type": "string"
                                        }
                                    },
                                    "system_prop": true,
                                    "title": "File Information",
                                    "type": "object"
                                },
                                "system_identifier_doi": {
                                    "format": "object",
                                    "properties": {
                                        "subitem_systemidt_identifier": {
                                            "format": "text",
                                            "title": "SYSTEMIDT Identifier",
                                            "type": "string"
                                        },
                                        "subitem_systemidt_identifier_type": {
                                            "enum": [
                                                "DOI",
                                                "HDL",
                                                "URI"
                                            ],
                                            "format": "select",
                                            "title": "SYSTEMIDT Identifier Type",
                                            "type": "string"
                                        }
                                    },
                                    "system_prop": true,
                                    "title": "Persistent Identifier(DOI)",
                                    "type": "object"
                                },
                                "system_identifier_hdl": {
                                    "format": "object",
                                    "properties": {
                                        "subitem_systemidt_identifier": {
                                            "format": "text",
                                            "title": "SYSTEMIDT Identifier",
                                            "type": "string"
                                        },
                                        "subitem_systemidt_identifier_type": {
                                            "enum": [
                                                "DOI",
                                                "HDL",
                                                "URI"
                                            ],
                                            "format": "select",
                                            "title": "SYSTEMIDT Identifier Type",
                                            "type": "string"
                                        }
                                    },
                                    "system_prop": true,
                                    "title": "Persistent Identifier(HDL)",
                                    "type": "object"
                                },
                                "system_identifier_uri": {
                                    "format": "object",
                                    "properties": {
                                        "subitem_systemidt_identifier": {
                                            "format": "text",
                                            "title": "SYSTEMIDT Identifier",
                                            "type": "string"
                                        },
                                        "subitem_systemidt_identifier_type": {
                                            "enum": [
                                                "DOI",
                                                "HDL",
                                                "URI"
                                            ],
                                            "format": "select",
                                            "title": "SYSTEMIDT Identifier Type",
                                            "type": "string"
                                        }
                                    },
                                    "system_prop": true,
                                    "title": "Persistent Identifier(URI)",
                                    "type": "object"
                                }
                                  },
                                  "required": [
                                      "pubdate"
                                  ],
                                  "type": "object"
                              }
                  token:
                    type: string
                    description: アクティビティへのアクセスに必要なtoken（ゲストユーザの場合のみ）
                    example: QS0yMDIzMDgwMy0wMDAwMSAyMDIzLTA4LTAzIGF0c3VzaGkuc3V6dWtpQGl2aXMuY28uanAgMkEyM0RFMEY1ODI0QjU2RQ==
        "400":
          description: |-
            リクエスト形式不正  
            ・ゲストユーザの場合にメールアドレスがない
            ・メールアドレス形式が不正
            ・terms_tokenが一致しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "401":
          description: OAuth2認証失敗
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "403":
          description: |-
            権限エラー  
            ・ユーザロールに該当するワークフローが設定されていない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "404":
          description: |-
            存在しない  
            ・アイテムが存在しない
            ・ファイルが存在しない
            ・ワークフローが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "429":
          description: |-
            リクエスト制限  
            ・リミットレートを超えてアクセスされた
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
      security:
        - OAuth2: ["user:activity"]
  
  /api/{version}/workflow/activities/{activity_id}/application:
    post:
      tags:
        - workflow
      summary: 利用申請API
      description: |-
        制限公開ファイルの利用申請のワークフローにおける申請内容の登録を行う
        |ロール|動作|
        |----|----|
        |システム管理者|使用可能|
        |リポジトリ管理者|使用可能|
        |コミュニティ管理者|使用可能|
        |登録ユーザー|使用可能|
        |一般ユーザー|使用可能|
        |ゲストユーザー|使用可能|
      parameters:
        - name: version
          in: path
          description: このAPIのバージョン情報
          required: true
          schema:
            type: string
          example: v1
        - name: activity_id
          in: path
          description: アクティビティを一意に識別するID
          required: true
          schema:
            type: string
          example: "A-20230803-00001"
        - name: Authorization
          in: header
          description: 認可情報
          schema:
            type: string
            example: Bearer アクセストークン
        - name: Accept-Language
          in: header
          description: 言語
          schema:
            type: string
            default: en
        - name: pretty
          in: query
          description: レスポンスの整形
          schema:
            type: boolean
            default: false
        - name: index_ids
          in: query
          description: アイテムの登録先インデックスID（カンマ区切りで複数インデックス指定可）
          schema:
            type: string
          example: "101,22"
        - name: token
          in: query
          description: アクティビティへのアクセスに必要なtoken（ゲストユーザの場合のみ）
          schema:
            type: string
      requestBody:
        description:
          ItemRegistration入力項目
        required: true
        content:
          application/json:
            schema:
              type: object
              example:
                item_1616221831877: 
                  subitem_restricted_access_dataset_usage: Sample Data Set
                item_1616221851421:
                  subitem_restricted_access_name: 徳川家康
                  subitem_restricted_access_mail_address: ieyasu.tokugawa@example.org
                item_1616221894659:
                  - subitem_restricted_access_institution_name: 戦国学会
                    subitem_restricted_access_institution_position: 理事・役員
                  - subitem_restricted_access_institution_name: 江戸学会
                    subitem_restricted_access_institution_position: 会長
                item_1616221941275:
                  subitem_restricted_access_research_title: 幕府運営に関する研究
                item_1616222047122:
                  subitem_restricted_access_wf_issued_date: "2023-07-18"
                  subitem_restricted_access_wf_issued_date_type: Created

      responses:
        "200":
          description: メタデータ登録成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  action_info:
                    description: アクション情報
                    type: object
                    properties:
                      action_id:
                        description: アクションID(ItemRegistrationアクションは3固定)
                        type: integer
                        example: 3
                      action_date:
                        description: 更新日
                        type: string
                        example: "2023/7/1 14:00:00.000"
                      action_user:
                        description: 更新者のID
                        type: integer
                        example: 1
                      action_status:
                        description: 更新結果のステータス(入力項目の登録成功:F)
                        type: string
                        example: F
                      action_comment:
                        description: コメント(本APIでの登録時はnull固定)
                        type: string
                        example: null
                  registerd_data:
                    description: 申請内容（records_metadataに保存された内容）
                    type: object
                    example: 
                      metainfo:
                        $schema: "40010"
                        created_by: 1
                        deleted_items: []
                        edit_mode: "keep"
                        id: "19"
                        item_1616221831877: 
                          subitem_restricted_access_dataset_usage: Sample Data Set
                        item_1616221851421:
                          - subitem_restricted_access_name: "徳川家康"
                            subitem_restricted_access_mail_address: "ieyasu.tokugawa@example.org"
                      endpoints:
                        initialization: "/api/deposits/redirect/19.0"
        "400":
          description: |-
            リクエスト形式不正<br>
            ・アクティビティの現在のアクションがItemRegistrationでない<br>
            ・tokenが不正な値である<br>
            ・ゲストアクティビティの有効期限が切れている<br>
            ・ItemRegistrationの必須項目の値が不足している<br>
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "401":
          description: OAuth2認証失敗
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "403":
          description: |-
            権限エラー<br>
            ・ユーザーにアクション実行権限がない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "404":
          description: |-
            存在しない<br>
            ・アクティビティが存在しない<br>
            ・アイテムが存在しない<br>
            ・ファイルが存在しない<br>
            ・インデックスが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
        "429":
          description: |-
            リクエスト制限<br>
            ・リミットレートを超えてアクセスされた
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBody"
      security:
        - OAuth2: ["user:activity"]

components:
  schemas:
    ErrorBody:
      type: object
      properties:
        status:
          description: HTTPステータスコード
          type: string
        message:
          description: エラーメッセージ
          type: string
  securitySchemes:
    OAuth2:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://example.com/oauth/authorize
          tokenUrl: https://example.com/oauth/token
          scopes:
            "user:activity": Allow create Workflow Activity
